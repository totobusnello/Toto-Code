<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-740-quality-setup - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-740-quality-setup</h1>
    <p>L2 Domain Coordinator - Configures linters, pre-commit hooks, and test infrastructure</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> Analyze: Start Quality Setup

    state Analyze {
        [*] --> DetectStack
        DetectStack --> CheckExisting
        CheckExisting --> PlanConfig
        PlanConfig --> [*]
    }

    Analyze --> Execute: Plan Ready

    state Execute {
        [*] --> Linters
        Linters --> Hooks: Linters Configured
        Hooks --> Tests: Hooks Installed
        Tests --> [*]: Tests Setup

        Linters: ln-741 Linter Configurator
        Hooks: ln-742 Pre-commit Setup
        Tests: ln-743 Test Infrastructure
    }

    Execute --> Verify: All Configured
    Verify --> [*]: Complete
    </div>

    <h2>Linter Stack by Technology</h2>
    <div class="mermaid">
flowchart TD
    Start([Detect Stack]) --> Tech{Technology?}

    Tech -->|TypeScript| TS[TypeScript Stack]
    Tech -->|.NET| NET[.NET Stack]
    Tech -->|Python| PY[Python Stack]

    subgraph TS[TypeScript Stack]
        ESLint[ESLint Flat Config]
        Prettier[Prettier]
        TSCheck[TypeScript Strict]
    end

    subgraph NET[.NET Stack]
        DotnetFormat[dotnet format]
        Analyzers[Roslyn Analyzers]
        EditorConfig[.editorconfig]
    end

    subgraph PY[Python Stack]
        Ruff[Ruff Linter + Formatter]
        RuffFormat[replaces Black, flake8, isort]
    end

    ESLint --> Output([Generated Configs])
    DotnetFormat --> Output
    Ruff --> Output

    classDef tool fill:#E6E6FA
    classDef note fill:#FFF8DC
    class ESLint,Prettier,TSCheck,DotnetFormat,Analyzers,EditorConfig,Ruff tool
    class RuffFormat note
    </div>

    <h2>Pre-commit Hook Flow</h2>
    <div class="mermaid">
sequenceDiagram
    participant Dev as Developer
    participant Git as Git
    participant Husky as Husky
    participant Lint as lint-staged
    participant Commit as commitlint

    Dev->>Git: git commit
    Git->>Husky: pre-commit hook

    rect rgb(255, 230, 200)
        Note over Husky,Commit: Pre-commit Checks
        Husky->>Lint: Run lint-staged
        Lint->>Lint: eslint --fix staged files
        Lint->>Lint: prettier --write staged files
        Lint-->>Husky: Linting passed
    end

    Husky->>Git: Allow commit

    Git->>Husky: commit-msg hook
    Husky->>Commit: Validate message
    Commit-->>Husky: Valid conventional commit
    Husky->>Git: Commit created

    Git-->>Dev: Commit successful
    </div>

    <h2>Test Infrastructure</h2>
    <div class="mermaid">
flowchart LR
    subgraph Frontend["Frontend Tests (TypeScript)"]
        Vitest[Vitest]
        RTL[React Testing Library]
    end

    subgraph Backend["Backend Tests (.NET)"]
        xUnit[xUnit]
        Moq[Moq]
        FA[FluentAssertions]
    end

    subgraph Python["Python Tests"]
        Pytest[pytest]
        PytestCov[pytest-cov]
    end

    subgraph Coverage["Coverage Targets: 80%+"]
        Istanbul[v8/Istanbul]
        Coverlet[Coverlet]
        CovPy[coverage.py]
    end

    Vitest --> Istanbul
    xUnit --> Coverlet
    Pytest --> CovPy

    classDef frontend fill:#87CEEB
    classDef backend fill:#90EE90
    classDef python fill:#FFE4B5
    classDef coverage fill:#FFD700
    class Vitest,RTL frontend
    class xUnit,Moq,FA backend
    class Pytest,PytestCov python
    class Istanbul,Coverlet,CovPy coverage
    </div>

    <footer>
        <p>ln-740-quality-setup v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
