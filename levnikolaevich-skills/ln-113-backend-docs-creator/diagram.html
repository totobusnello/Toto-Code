<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-113-backend-docs-creator - State Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="../shared/css/diagram.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ln-113-backend-docs-creator</h1>
            <p class="subtitle">L3 Worker - Backend Documentation Creator - State Diagram</p>
        </header>

        <div class="info-box">
            <h3>Workflow Overview</h3>
            <ul>
                <li><strong>Purpose:</strong> Create api_spec.md and database_schema.md (CONDITIONAL)</li>
                <li><strong>Invoked by:</strong> ln-110-project-docs-coordinator when hasBackend OR hasDatabase</li>
                <li><strong>Key feature:</strong> OpenAPI 3.0 compliant API spec, ER diagrams in Mermaid</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color color-action"></div>
                <span>Action</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-decision"></div>
                <span>Decision</span>
            </div>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
graph TD
    Start([Start: ln-113]) --> P1[Phase 1: Check Conditions<br/>Parse flags from coordinator]

    P1 --> CheckFlags{hasBackend OR<br/>hasDatabase?}
    CheckFlags -->|No| EarlyReturn([Return empty result<br/>No backend/database detected])
    CheckFlags -->|Yes| Determine[Determine documents to create]

    Determine --> P2[Phase 2: Create Documents]

    P2 --> ApiCheck{hasBackend?}
    ApiCheck -->|No| DbCheck
    ApiCheck -->|Yes| ApiExists{api_spec.md<br/>exists?}
    ApiExists -->|Yes| ApiSkip[Skip with log]
    ApiExists -->|No| ApiCreate[Create api_spec.md<br/>OpenAPI 3.0 format]
    ApiCreate --> ApiEndpoints[Populate endpoint table<br/>from API_ENDPOINTS]
    ApiEndpoints --> ApiAuth[Add AUTH_SCHEME<br/>JWT, OAuth2, API keys]
    ApiAuth --> ApiExamples[Add request/response<br/>examples]
    ApiExamples --> ApiTBD[Mark TBD for<br/>missing data]

    ApiSkip --> DbCheck
    ApiTBD --> DbCheck

    DbCheck{hasDatabase?}
    DbCheck -->|No| P3
    DbCheck -->|Yes| DbExists{database_schema.md<br/>exists?}
    DbExists -->|Yes| DbSkip[Skip with log]
    DbExists -->|No| DbCreate[Create database_schema.md]
    DbCreate --> DbSchema[Populate from<br/>SCHEMA_OVERVIEW]
    DbSchema --> DbER[Generate ER diagram<br/>Mermaid erDiagram format]
    DbER --> DbTables[Add table definitions<br/>columns, types, constraints]
    DbTables --> DbTBD[Mark TBD for<br/>missing data]

    DbSkip --> P3
    DbTBD --> P3

    P3[Phase 3: Self-Validate] --> V1[Check SCOPE tag]
    V1 --> V2[Validate format:<br/>endpoints, ER diagram]
    V2 --> V3[Check Maintenance section]

    V3 --> P4[Phase 4: Return Status]
    P4 --> Output[Return to coordinator:<br/>created[], skipped[], tbd_count]
    Output --> End([End: 0-2 docs processed])

    classDef action fill:#C8E6C9,stroke:#388E3C,stroke-width:2px
    classDef decision fill:#FFE0B2,stroke:#E64A19,stroke-width:2px

    class P1,Determine,P2,ApiSkip,ApiCreate,ApiEndpoints,ApiAuth,ApiExamples,ApiTBD,DbSkip,DbCreate,DbSchema,DbER,DbTables,DbTBD,P3,V1,V2,V3,P4,Output action
    class CheckFlags,ApiCheck,ApiExists,DbCheck,DbExists decision
            </div>
        </div>

        <div class="info-box">
            <h3>Conditional Documents</h3>
            <ul>
                <li><strong>api_spec.md:</strong> Created when hasBackend (express, fastify, nestjs, fastapi)</li>
                <li><strong>database_schema.md:</strong> Created when hasDatabase (pg, mongoose, prisma, sequelize)</li>
            </ul>
        </div>

        <footer>
            <p>Generated for ln-113-backend-docs-creator skill | Version 1.0.0</p>
            <p>Diagram format: Mermaid.js | Last updated: 2025-12-20</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
