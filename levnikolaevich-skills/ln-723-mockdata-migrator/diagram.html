<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-723-mockdata-migrator - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-723-mockdata-migrator</h1>
    <p>L3 Worker - Migrates ORM schemas to C# MockData classes</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> ParseSchema: Start Migration

    state ParseSchema {
        [*] --> LocateFile
        LocateFile --> DetectORM
        DetectORM --> ExtractTables
        ExtractTables --> ExtractColumns
        ExtractColumns --> ExtractConstraints
        ExtractConstraints --> [*]
    }

    ParseSchema --> MapTypes: Schema Parsed

    state MapTypes {
        [*] --> MapColumnTypes
        MapColumnTypes --> DetermineNullable
        DetermineNullable --> IdentifyPKs
        IdentifyPKs --> MapFKs
        MapFKs --> TransformNames
        TransformNames --> [*]
    }

    MapTypes --> GenerateMockData: Types Mapped

    state GenerateMockData {
        [*] --> CreateClass
        CreateClass --> GenerateGUIDs
        GenerateGUIDs --> GenerateSamples
        GenerateSamples --> ValidateFKs
        ValidateFKs --> CreateAccessors
        CreateAccessors --> [*]
    }

    GenerateMockData --> Verify: MockData Ready
    Verify --> [*]: Success
    </div>

    <h2>Type Conversion Flow</h2>
    <div class="mermaid">
flowchart TD
    Input([ORM Column]) --> Detect{Detect Type}

    Detect -->|uuid| UUID[Guid]
    Detect -->|varchar| String[string]
    Detect -->|integer| Int[int]
    Detect -->|boolean| Bool[bool]
    Detect -->|timestamp| DateTime[DateTime]
    Detect -->|json| Json[JsonDocument]

    UUID --> Nullable{Has .notNull()?}
    String --> Nullable
    Int --> NonNull[Non-nullable]
    Bool --> NonNull
    DateTime --> Nullable
    Json --> NullableType[Nullable by default]

    Nullable -->|Yes| NonNull
    Nullable -->|No| NullableType

    NonNull --> Output([C# Property])
    NullableType --> Output

    classDef type fill:#E3F2FD
    classDef decision fill:#FFE0B2
    class UUID,String,Int,Bool,DateTime,Json type
    class Detect,Nullable decision
    </div>

    <h2>Generation Order by Dependency</h2>
    <div class="mermaid">
sequenceDiagram
    participant S as Schema Parser
    participant G as Generator
    participant M as MockData

    Note over S,M: Dependency-Ordered Generation

    S->>G: Users (no FK)
    G->>M: Generate User MockData
    Note right of M: 3-5 users with GUIDs

    S->>G: Projects (user FK)
    G->>M: Generate Project MockData
    Note right of M: References valid User IDs

    S->>G: Epics (project FK)
    G->>M: Generate Epic MockData
    Note right of M: References valid Project IDs

    S->>G: Stories (epic FK)
    G->>M: Generate Story MockData
    Note right of M: References valid Epic IDs

    S->>G: Tasks (story FK)
    G->>M: Generate Task MockData
    Note right of M: References valid Story IDs
    </div>

    <h2>Schema Parsing Flow</h2>
    <div class="mermaid">
flowchart LR
    subgraph Input["ORM Schema"]
        Drizzle["pgTable('epics', {...})"]
        Prisma["model Epic {...}"]
        TypeORM["@Entity() class Epic"]
    end

    subgraph Parse["Parse Phase"]
        Detect[Detect ORM Type]
        Extract[Extract Definitions]
    end

    subgraph Output["Extracted Model"]
        Entity[Entity Name]
        Columns[Column Definitions]
        Constraints[Constraints]
        Relations[Relationships]
    end

    Drizzle --> Detect
    Prisma --> Detect
    TypeORM --> Detect
    Detect --> Extract
    Extract --> Entity
    Extract --> Columns
    Extract --> Constraints
    Extract --> Relations

    classDef input fill:#FFB6C1
    classDef process fill:#FFFACD
    classDef output fill:#90EE90
    class Drizzle,Prisma,TypeORM input
    class Detect,Extract process
    class Entity,Columns,Constraints,Relations output
    </div>

    <h2>MockData Class Structure</h2>
    <div class="mermaid">
flowchart TD
    subgraph MockDataClass["ProductPlanningMockData"]
        List["private static List<EpicDto> _epics"]
        GetAll["GetEpics(): IEnumerable<EpicDto>"]
        GetById["GetEpicById(Guid id): EpicDto?"]
        GetByFK["GetEpicsByProjectId(Guid id): IEnumerable<EpicDto>"]
    end

    subgraph SampleData["Sample Data (5-10 items)"]
        Item1["Epic 1: User Auth"]
        Item2["Epic 2: Dashboard"]
        Item3["Epic 3: Reports"]
        ItemN["..."]
    end

    List --> SampleData
    GetAll --> List
    GetById --> List
    GetByFK --> List

    classDef private fill:#FFE0B2
    classDef public fill:#C8E6C9
    classDef data fill:#E3F2FD
    class List private
    class GetAll,GetById,GetByFK public
    class Item1,Item2,Item3,ItemN data
    </div>

    <footer>
        <p>ln-723-mockdata-migrator v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
