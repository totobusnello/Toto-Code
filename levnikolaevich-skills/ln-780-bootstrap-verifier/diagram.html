<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-780-bootstrap-verifier - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-780-bootstrap-verifier</h1>
    <p>L2 Domain Coordinator - Orchestrates final verification pipeline</p>

    <h2>Main Orchestration Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> PreFlight: Start Verification

    state PreFlight {
        [*] --> CheckDocker
        CheckDocker --> CheckPorts
        CheckPorts --> DetectProjects
        DetectProjects --> [*]
    }
    note right of PreFlight: Phase 1: Environment Checks

    PreFlight --> Build: Environment Ready
    PreFlight --> Report: Environment Failed

    state Build {
        [*] --> DelegateToLn781
        DelegateToLn781 --> CollectBuildResults
        CollectBuildResults --> [*]
    }
    note right of Build: Phase 2: ln-781-build-verifier

    Build --> Test: Build Success
    Build --> Report: Build Failed

    state Test {
        [*] --> DelegateToLn782
        DelegateToLn782 --> CollectTestResults
        CollectTestResults --> [*]
    }
    note right of Test: Phase 3: ln-782-test-runner

    Test --> Container: Tests Pass
    Test --> Container: Tests Fail (if skipTestsOnFailure)
    Test --> Report: Tests Fail

    state Container {
        [*] --> DelegateToLn783
        DelegateToLn783 --> CollectHealthResults
        CollectHealthResults --> [*]
    }
    note right of Container: Phase 4: ln-783-container-launcher

    Container --> Report: Container Result

    state Report {
        [*] --> AggregateResults
        AggregateResults --> GenerateNextSteps
        GenerateNextSteps --> DisplayToUser
        DisplayToUser --> [*]
    }
    note right of Report: Phase 5: Final Report

    Report --> [*]: Verification Complete
    </div>

    <h2>Worker Delegation Pattern</h2>
    <div class="mermaid">
flowchart TD
    subgraph Orchestrator["ln-780-bootstrap-verifier (L2)"]
        O1[Pre-flight Checks]
        O2[Delegate Build]
        O3[Delegate Test]
        O4[Delegate Container]
        O5[Aggregate Results]
        O6[Generate Report]
    end

    subgraph Workers["L3 Workers"]
        W1[ln-781-build-verifier]
        W2[ln-782-test-runner]
        W3[ln-783-container-launcher]
    end

    O1 --> O2
    O2 -->|Skill tool| W1
    W1 -->|Results| O3
    O3 -->|Skill tool| W2
    W2 -->|Results| O4
    O4 -->|Skill tool| W3
    W3 -->|Results| O5
    O5 --> O6

    classDef orchestrator fill:#E6E6FA
    classDef worker fill:#87CEEB
    class O1,O2,O3,O4,O5,O6 orchestrator
    class W1,W2,W3 worker
    </div>

    <h2>Pre-flight Check Sequence</h2>
    <div class="mermaid">
flowchart TD
    Start([Start Pre-flight]) --> Docker{Docker Available?}

    Docker -->|Yes| Compose{Compose Available?}
    Docker -->|No| SkipContainer[Skip Container Phase]

    Compose -->|Yes| Ports{Ports Free?}
    Compose -->|No| SkipContainer

    Ports -->|Yes| Detect[Detect Project Types]
    Ports -->|No| Warn[Warn User]
    Warn --> Detect

    Detect --> Projects{Projects Found?}
    Projects -->|Yes| Ready([Environment Ready])
    Projects -->|No| Fail([No Projects to Verify])

    SkipContainer --> Detect

    classDef success fill:#90EE90
    classDef warning fill:#FFE4B5
    classDef fail fill:#FFB6C1
    class Ready success
    class Warn,SkipContainer warning
    class Fail fail
    </div>

    <h2>Report Structure</h2>
    <div class="mermaid">
flowchart TD
    Report([Verification Report])

    Report --> Build[Build Results]
    Report --> Tests[Test Results]
    Report --> Docker[Container Status]
    Report --> Health[Health Checks]
    Report --> Next[Next Steps]

    subgraph Build["Build Section"]
        BF[Project: status, duration, output]
    end

    subgraph Tests["Test Section"]
        TF[Suite: total, passed, failed]
    end

    subgraph Docker["Container Section"]
        DF[Container: name, status, port, health]
    end

    subgraph Health["Health Section"]
        HF[Endpoint: url, status, responseTime]
    end

    subgraph Next["Next Steps"]
        N1[Access URLs]
        N2[Explore API]
        N3[Commit changes]
    end

    classDef section fill:#E6E6FA
    classDef item fill:#F0F0F0
    class Build,Tests,Docker,Health,Next section
    class BF,TF,DF,HF,N1,N2,N3 item
    </div>

    <footer>
        <p>ln-780-bootstrap-verifier v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
