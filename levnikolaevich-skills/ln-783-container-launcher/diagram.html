<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-783-container-launcher - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-783-container-launcher</h1>
    <p>L3 Worker - Builds and launches Docker containers with health verification</p>

    <h2>Container Launch Workflow</h2>
    <div class="mermaid">
flowchart TD
    Start([Start Container Launcher]) --> PreFlight[Step 1: Pre-flight Checks]

    PreFlight --> DockerOK{Docker Available?}
    DockerOK -->|No| DockerFail([Docker Not Available])
    DockerOK -->|Yes| Parse[Step 2: Parse Compose Config]

    Parse --> ComposeOK{Compose File Valid?}
    ComposeOK -->|No| ComposeFail([Invalid Compose File])
    ComposeOK -->|Yes| Build[Step 3: Build Images]

    Build --> BuildOK{Build Success?}
    BuildOK -->|No| BuildFail[Log Build Errors]
    BuildOK -->|Yes| Launch[Step 4: Launch Containers]

    Launch --> LaunchOK{Containers Started?}
    LaunchOK -->|No| LaunchFail[Log Launch Errors]
    LaunchOK -->|Yes| Health[Step 5: Health Verification]

    Health --> HealthOK{All Healthy?}
    HealthOK -->|No| HealthFail[Collect Logs]
    HealthOK -->|Yes| Report[Step 6: Report Results]

    BuildFail --> Report
    LaunchFail --> Report
    HealthFail --> Report

    Report --> Done([Return to Orchestrator])

    classDef success fill:#90EE90
    classDef fail fill:#FFB6C1
    classDef process fill:#E6E6FA
    class Done success
    class DockerFail,ComposeFail,BuildFail,LaunchFail,HealthFail fail
    class PreFlight,Parse,Build,Launch,Health,Report process
    </div>

    <h2>Health Check Strategy</h2>
    <div class="mermaid">
flowchart TD
    Start([Health Verification]) --> CheckType{Healthcheck Defined?}

    CheckType -->|Yes| Native[Use Docker Native Health]
    CheckType -->|No| External[Use External Probe]

    Native --> Wait[Wait for healthy status]
    External --> Probe[HTTP/TCP Probe]

    Wait --> Retry{Max Attempts?}
    Probe --> Retry

    Retry -->|No, retry| Backoff[Exponential Backoff]
    Backoff --> Wait
    Backoff --> Probe

    Retry -->|Yes, exhausted| Timeout[Health Check Timeout]
    Wait --> Healthy{Status healthy?}
    Probe --> Healthy

    Healthy -->|Yes| Success([Container Healthy])
    Healthy -->|No| Retry

    Timeout --> Fail([Health Check Failed])

    classDef success fill:#90EE90
    classDef fail fill:#FFB6C1
    classDef strategy fill:#87CEEB
    classDef retry fill:#FFE4B5
    class Success success
    class Fail,Timeout fail
    class Native,External strategy
    class Backoff,Retry retry
    </div>

    <h2>Retry Configuration</h2>
    <div class="mermaid">
flowchart LR
    subgraph Retry["Exponential Backoff"]
        A1[Attempt 1: 5s]
        A2[Attempt 2: 10s]
        A3[Attempt 3: 20s]
        A4[Attempt 4: 40s]
        AN[... up to 10 attempts]
    end

    subgraph Limits["Limits"]
        Max[Max Wait: 120s]
        Attempts[Max Attempts: 10]
    end

    A1 --> A2 --> A3 --> A4 --> AN

    classDef attempt fill:#E6E6FA
    classDef limit fill:#FFE4B5
    class A1,A2,A3,A4,AN attempt
    class Max,Attempts limit
    </div>

    <h2>Result Structure</h2>
    <div class="mermaid">
flowchart TD
    Results([Container Results])

    Results --> Containers[containers]
    Results --> Health[healthChecks]
    Results --> URLs[accessUrls]
    Results --> Status[overallStatus]

    Containers --> C1[name, service, status, health, port]
    Health --> H1[url, status, responseTime, healthy]
    URLs --> U1[serviceName: accessUrl]
    Status --> S1[healthy / unhealthy / partial]

    classDef result fill:#E6E6FA
    classDef data fill:#F0F0F0
    class Containers,Health,URLs,Status result
    class C1,H1,U1,S1 data
    </div>

    <footer>
        <p>ln-783-container-launcher v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
