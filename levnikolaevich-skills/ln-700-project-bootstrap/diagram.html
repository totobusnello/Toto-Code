<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-700-project-bootstrap - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-700-project-bootstrap</h1>
    <p>L1 Top Orchestrator - Full project bootstrap from prototype to production</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> Analyze: Start Bootstrap

    state Analyze {
        [*] --> DetectFrontend
        DetectFrontend --> DetectBackend
        DetectBackend --> DetectDatabase
        DetectDatabase --> DetectORM
        DetectORM --> DetectStructure
        DetectStructure --> [*]
    }

    Analyze --> Plan: Stack Detected

    state Plan {
        [*] --> GeneratePlan
        GeneratePlan --> CalculateChanges
        CalculateChanges --> EstimateRisks
        EstimateRisks --> [*]
    }

    Plan --> Confirm: Plan Ready
    Confirm --> Execute: User Approved
    Confirm --> Plan: User Requests Changes

    state Execute {
        [*] --> ln710
        ln710 --> ln720: Dependencies OK
        ln720 --> ln730: Structure OK
        ln730 --> ln740: DevOps OK
        ln740 --> ln750: Quality OK
        ln750 --> ln760: Commands OK
        ln760 --> ln770: Security OK
        ln770 --> ln780: Crosscutting OK
        ln780 --> [*]: Verified

        ln710: ln-710 Dependency Upgrader
        ln720: ln-720 Structure Migrator
        ln730: ln-730 DevOps Setup
        ln740: ln-740 Quality Setup
        ln750: ln-750 Commands Generator
        ln760: ln-760 Security Setup
        ln770: ln-770 Crosscutting Setup
        ln780: ln-780 Bootstrap Verifier
    }

    Execute --> Report: All Steps Complete
    Execute --> HandleError: Step Failed

    HandleError --> AskUser: Log Error
    AskUser --> Execute: Continue
    AskUser --> Rollback: Abort

    Rollback --> [*]: Restored

    Report --> [*]: Bootstrap Complete
    </div>

    <h2>Technology Detection Flow</h2>
    <div class="mermaid">
flowchart TD
    Start([Start Detection]) --> CheckPackageJson{package.json exists?}

    CheckPackageJson -->|Yes| ParseDeps[Parse Dependencies]
    CheckPackageJson -->|No| CheckCsproj{*.csproj exists?}

    ParseDeps --> DetectReact{react in deps?}
    DetectReact -->|Yes| ReactDetected[Frontend: React]
    DetectReact -->|No| DetectVue{vue in deps?}
    DetectVue -->|Yes| VueDetected[Frontend: Vue]
    DetectVue -->|No| DetectAngular{@angular/core?}
    DetectAngular -->|Yes| AngularDetected[Frontend: Angular]
    DetectAngular -->|No| NoFrontend[No Frontend]

    ReactDetected --> DetectBuildTool
    VueDetected --> DetectBuildTool
    AngularDetected --> DetectBuildTool
    NoFrontend --> DetectBuildTool

    DetectBuildTool{vite.config?} -->|Yes| Vite[Build: Vite]
    DetectBuildTool -->|No| CheckCRA{react-scripts?}
    CheckCRA -->|Yes| CRA[Build: CRA]
    CheckCRA -->|No| CheckNext{next.config?}
    CheckNext -->|Yes| Next[Build: Next.js]
    CheckNext -->|No| NoBuild[Build: Unknown]

    Vite --> DetectBackend
    CRA --> DetectBackend
    Next --> DetectBackend
    NoBuild --> DetectBackend

    CheckCsproj -->|Yes| DotNetDetected[Backend: .NET]
    CheckCsproj -->|No| CheckPython{requirements.txt?}
    CheckPython -->|Yes| PythonDetected[Backend: Python]
    CheckPython -->|No| CheckGo{go.mod?}
    CheckGo -->|Yes| GoDetected[Backend: Go]
    CheckGo -->|No| NodeBackend[Backend: Node.js]

    DetectBackend{express in deps?} -->|Yes| ExpressDetected[Current: Express]
    DetectBackend -->|No| NodeBackend

    DotNetDetected --> DetectDatabase
    PythonDetected --> DetectDatabase
    GoDetected --> DetectDatabase
    ExpressDetected --> DetectDatabase
    NodeBackend --> DetectDatabase

    DetectDatabase{Check docker-compose} --> PostgresCheck{postgres image?}
    PostgresCheck -->|Yes| Postgres[DB: PostgreSQL]
    PostgresCheck -->|No| MongoCheck{mongo image?}
    MongoCheck -->|Yes| Mongo[DB: MongoDB]
    MongoCheck -->|No| MySQLCheck{mysql image?}
    MySQLCheck -->|Yes| MySQL[DB: MySQL]
    MySQLCheck -->|No| NoDocker[DB: From ENV]

    Postgres --> DetectORM
    Mongo --> DetectORM
    MySQL --> DetectORM
    NoDocker --> DetectORM

    DetectORM{drizzle.config?} -->|Yes| Drizzle[ORM: Drizzle]
    DetectORM -->|No| PrismaCheck{prisma/schema?}
    PrismaCheck -->|Yes| Prisma[ORM: Prisma]
    PrismaCheck -->|No| EFCheck{EF in csproj?}
    EFCheck -->|Yes| EFCore[ORM: EF Core]
    EFCheck -->|No| NoORM[ORM: None]

    Drizzle --> Output
    Prisma --> Output
    EFCore --> Output
    NoORM --> Output

    Output([Detection Complete])

    classDef detected fill:#90EE90
    classDef notfound fill:#FFB6C1
    class ReactDetected,VueDetected,AngularDetected,Vite,DotNetDetected,ExpressDetected,Postgres,Drizzle detected
    class NoFrontend,NoBuild,NoORM notfound
    </div>

    <h2>Delegation Sequence</h2>
    <div class="mermaid">
sequenceDiagram
    participant O as ln-700 Orchestrator
    participant D as ln-710 Dependencies
    participant S as ln-720 Structure
    participant V as ln-730 DevOps
    participant Q as ln-740 Quality
    participant C as ln-750 Commands
    participant X as ln-760 Security
    participant CC as ln-770 Crosscutting
    participant B as ln-780 Verifier

    O->>O: Detect Stack
    O->>O: Generate Plan
    O->>O: Get User Approval

    rect rgb(200, 230, 200)
        Note over O,B: Execute Phase
        O->>+D: Upgrade Dependencies
        D-->>-O: Dependencies OK

        O->>+S: Migrate Structure
        S-->>-O: Structure OK

        O->>+V: Setup DevOps
        V-->>-O: DevOps OK

        O->>+Q: Setup Quality
        Q-->>-O: Quality OK

        O->>+C: Generate Commands
        C-->>-O: Commands OK

        O->>+X: Setup Security
        X-->>-O: Security OK

        O->>+CC: Setup Crosscutting
        CC-->>-O: Crosscutting OK

        O->>+B: Verify Bootstrap
        B-->>-O: All Verified
    end

    O->>O: Generate Report
    </div>

    <h2>Error Handling</h2>
    <div class="mermaid">
flowchart TD
    Start([Step Execution]) --> Execute[Execute Step]
    Execute --> Check{Success?}

    Check -->|Yes| NextStep([Continue to Next])
    Check -->|No| LogError[Log Error Details]

    LogError --> Recoverable{Recoverable?}

    Recoverable -->|Yes| TryFix[Attempt Auto-Fix]
    TryFix --> RetryCheck{Fixed?}
    RetryCheck -->|Yes| NextStep
    RetryCheck -->|No| AskUser{Ask User}

    Recoverable -->|No| AskUser

    AskUser -->|Continue| SkipStep[Skip with Warning]
    AskUser -->|Retry| Execute
    AskUser -->|Abort| Rollback[Rollback Changes]

    SkipStep --> NextStep
    Rollback --> RestoreBackup[Restore Backup]
    RestoreBackup --> Exit([Exit with Error])

    classDef error fill:#FFB6C1
    classDef success fill:#90EE90
    classDef warning fill:#FFD700
    class LogError,Rollback,Exit error
    class NextStep success
    class SkipStep warning
    </div>

    <footer>
        <p>ln-700-project-bootstrap v1.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
