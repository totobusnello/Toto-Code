<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-720-structure-migrator - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-720-structure-migrator</h1>
    <p>L2 Domain Coordinator - Restructures project to Clean Architecture</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> Analyze: Start Migration

    state Analyze {
        [*] --> ScanCurrent
        ScanCurrent --> MapFiles
        MapFiles --> IdentifyPatterns
        IdentifyPatterns --> [*]
    }

    Analyze --> Plan: Structure Mapped

    state Plan {
        [*] --> LoadTemplate
        LoadTemplate --> CalculateMoves
        CalculateMoves --> IdentifyConflicts
        IdentifyConflicts --> [*]
    }

    Plan --> Execute: Plan Ready

    state Execute {
        [*] --> ReplitClean
        ReplitClean --> Frontend: Artifacts Removed
        Frontend --> Backend: Frontend Done
        Backend --> MockData: Backend Done
        MockData --> [*]: All Done

        ReplitClean: ln-724 Replit Cleaner
        Frontend: ln-721 Frontend Restructure
        Backend: ln-722 Backend Generator
        MockData: ln-723 MockData Migrator
    }

    Execute --> Verify: Migration Complete
    Verify --> [*]: Success
    </div>

    <h2>Structure Transformation</h2>
    <div class="mermaid">
flowchart LR
    subgraph Before["Before (Replit)"]
        client[client/]
        server[server/]
        shared[shared/]
    end

    subgraph After["After (Clean Architecture)"]
        subgraph src[src/]
            frontend[frontend/]
            api[Project.Api/]
            domain[Project.Domain/]
            services[Project.Services/]
            repos[Project.Repositories/]
        end
    end

    client --> frontend
    server --> api
    shared --> domain

    classDef old fill:#FFB6C1
    classDef new fill:#90EE90
    class client,server,shared old
    class frontend,api,domain,services,repos new
    </div>

    <h2>Worker Delegation</h2>
    <div class="mermaid">
sequenceDiagram
    participant C as ln-720 Coordinator
    participant R as ln-724 Replit Cleaner
    participant F as ln-721 Frontend
    participant B as ln-722 Backend
    participant M as ln-723 MockData

    C->>C: Analyze Current Structure
    C->>C: Load Target Template

    rect rgb(200, 230, 200)
        Note over C,M: Sequential Execution
        C->>+R: Clean Replit Artifacts
        R->>R: Remove .replit, replit.nix
        R->>R: Remove @replit/* packages
        R-->>-C: Project Clean

        C->>+F: Restructure Frontend
        F->>F: Move to src/frontend/
        F->>F: Create components/, pages/, hooks/
        F-->>-C: Frontend Ready

        C->>+B: Generate Backend
        B->>B: Create .NET Clean Architecture
        B->>B: Generate Controllers, Services
        B-->>-C: Backend Ready

        C->>+M: Migrate Mock Data
        M->>M: Parse Drizzle Schema
        M->>M: Generate C# MockData
        M-->>-C: MockData Ready
    end

    C->>C: Generate Migration Report
    </div>

    <h2>Frontend Restructure Detail</h2>
    <div class="mermaid">
flowchart TD
    Start([Analyze Frontend]) --> Scan[Scan Source Files]

    Scan --> Classify[Classify Components]
    Classify --> Components[Extract Components]

    Components --> Pages[Create Pages/]
    Pages --> Hooks[Create Hooks/]
    Hooks --> Context[Create Contexts/]
    Context --> Lib[Create Lib/]

    Lib --> UpdateImports[Update All Imports]
    UpdateImports --> Verify[Verify Builds]
    Verify --> Done([Complete])

    classDef step fill:#E6E6FA
    class Scan,Classify,Components,Pages,Hooks,Context,Lib step
    </div>

    <footer>
        <p>ln-720-structure-migrator v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
