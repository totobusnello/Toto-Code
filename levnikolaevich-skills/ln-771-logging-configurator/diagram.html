<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-771-logging-configurator - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-771-logging-configurator</h1>
    <p>L3 Worker - Configures structured logging (Serilog/.NET, structlog/Python)</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> ReceiveContext: Start

    ReceiveContext --> IdempotencyCheck: Context Valid
    ReceiveContext --> Error: Missing Required Context

    IdempotencyCheck --> Skip: Already Configured
    IdempotencyCheck --> Research: Not Configured

    Research --> DecisionPoints: Best Practices Loaded
    DecisionPoints --> Generate: User Decisions Made
    Generate --> Validate: Files Generated
    Validate --> Return: Validation Passed
    Validate --> Error: Validation Failed

    Skip --> Return: Status = skipped
    Return --> [*]: Complete

    state ReceiveContext {
        [*] --> CheckStack
        CheckStack --> CheckFramework
        CheckFramework --> CheckVersion
        CheckVersion --> [*]
    }

    state Research {
        [*] --> MCPRef
        MCPRef --> Context7
        Context7 --> [*]
    }
    </div>

    <h2>Stack-Specific Configuration</h2>
    <div class="mermaid">
flowchart TD
    Stack{Technology Stack?}

    Stack -->|.NET| DotNet[Serilog Configuration]
    Stack -->|Python| Python[structlog Configuration]

    DotNet --> DotNetFiles[Generated Files]
    Python --> PythonFiles[Generated Files]

    subgraph DotNetFiles["".NET Output""]
        LogExt[Extensions/LoggingExtensions.cs]
        AppSettings[appsettings.json update]
        AppSettingsDev[appsettings.Development.json]
    end

    subgraph PythonFiles[""Python Output""]
        LogConfig[core/logging_config.py]
        LogMiddleware[middleware/logging_middleware.py]
    end

    DotNetFiles --> Packages1[Packages: Serilog.AspNetCore]
    PythonFiles --> Packages2[Packages: structlog]

    classDef dotnet fill:#512BD4,color:white
    classDef python fill:#3776AB,color:white
    class DotNet,LogExt,AppSettings,AppSettingsDev dotnet
    class Python,LogConfig,LogMiddleware python
    </div>

    <h2>Decision Points Flow</h2>
    <div class="mermaid">
flowchart LR
    subgraph Q1["Q1: Log Format"]
        JSON[JSON - Production]
        Pretty[Pretty - Development]
    end

    subgraph Q2["Q2: Enrichment Fields"]
        CorrelationId[correlationId]
        UserId[userId]
        RequestPath[requestPath]
        ResponseTime[responseTime]
    end

    subgraph Q3["Q3: Log Sinks"]
        Console[Console - Always]
        File[File - Optional]
        Seq[Seq - Optional]
        Elastic[Elasticsearch - Optional]
    end

    subgraph Q4["Q4: Log Levels"]
        Dev[Development: Debug]
        Prod[Production: Information]
    end

    Q1 --> Q2 --> Q3 --> Q4 --> Config[Final Configuration]

    classDef required fill:#90EE90
    classDef optional fill:#FFE4B5
    class JSON,Pretty,CorrelationId,UserId,RequestPath,ResponseTime,Console,Dev,Prod required
    class File,Seq,Elastic optional
    </div>

    <h2>Log Output Format</h2>
    <div class="mermaid">
flowchart TD
    Request([HTTP Request]) --> Middleware[Logging Middleware]

    Middleware --> Enrich{Enrich Log Entry}

    Enrich --> Fields[Standard Fields]

    subgraph Fields["Log Entry Fields"]
        timestamp["timestamp: ISO-8601"]
        level["level: info/warn/error"]
        message["message: Request completed"]
        correlationId["correlationId: abc-123"]
        requestPath["requestPath: /api/users"]
        responseTime["responseTime: 45ms"]
        statusCode["statusCode: 200"]
    end

    Fields --> Format{Output Format}
    Format -->|Production| JSONOut[JSON Output]
    Format -->|Development| PrettyOut[Pretty Console]

    classDef field fill:#FFD700
    class timestamp,level,message,correlationId,requestPath,responseTime,statusCode field
    </div>

    <footer>
        <p>ln-771-logging-configurator v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
