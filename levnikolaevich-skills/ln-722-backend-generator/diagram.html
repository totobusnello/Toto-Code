<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-722-backend-generator - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-722-backend-generator</h1>
    <p>L3 Worker - Generates .NET Clean Architecture backend structure</p>

    <h2>Main Workflow</h2>
    <div class="mermaid">
stateDiagram-v2
    [*] --> ReceiveContext: Start Generation

    state ReceiveContext {
        [*] --> ParseConfig
        ParseConfig --> ValidateEntities
        ValidateEntities --> [*]
    }

    ReceiveContext --> CreateSolution: Config Valid

    state CreateSolution {
        [*] --> CreateSln
        CreateSln --> CreateProjects
        CreateProjects --> AddReferences
        AddReferences --> [*]
    }

    CreateSolution --> GenerateDomain: Solution Ready

    state GenerateDomain {
        [*] --> CreateBaseEntity
        CreateBaseEntity --> GenerateEntities
        GenerateEntities --> GenerateEnums
        GenerateEnums --> [*]
    }

    GenerateDomain --> GenerateApi: Domain Ready

    state GenerateApi {
        [*] --> GenerateProgram
        GenerateProgram --> GenerateControllers
        GenerateControllers --> GenerateDTOs
        GenerateDTOs --> GenerateMiddleware
        GenerateMiddleware --> GenerateMockData
        GenerateMockData --> [*]
    }

    GenerateApi --> Verify: API Ready
    Verify --> [*]: Success
    </div>

    <h2>Layer Dependencies</h2>
    <div class="mermaid">
flowchart TB
    subgraph Outer["Outer Layers (Infrastructure)"]
        Api["{Project}.Api"]
    end

    subgraph Middle["Middle Layers (Application)"]
        Services["{Project}.Services"]
        Repos["{Project}.Repositories"]
    end

    subgraph Inner["Inner Layers (Core)"]
        Domain["{Project}.Domain"]
        Shared["{Project}.Shared"]
    end

    Api --> Services
    Api --> Domain
    Api --> Shared
    Services --> Domain
    Services --> Repos
    Services --> Shared
    Repos --> Domain
    Repos --> Shared
    Domain --> Shared

    classDef outer fill:#FFB6C1
    classDef middle fill:#FFFACD
    classDef inner fill:#90EE90
    class Api outer
    class Services,Repos middle
    class Domain,Shared inner
    </div>

    <h2>Generation Sequence</h2>
    <div class="mermaid">
sequenceDiagram
    participant C as Coordinator
    participant G as Generator
    participant FS as File System

    C->>G: Delegate (projectName, entities, options)

    rect rgb(200, 230, 200)
        Note over G,FS: Phase 2: Create Solution
        G->>FS: Create solution directory
        G->>FS: Write .sln file
        G->>FS: Create project directories
        G->>FS: Write .csproj files
    end

    rect rgb(230, 230, 200)
        Note over G,FS: Phase 3: Generate Domain
        G->>FS: Write BaseEntity.cs
        loop For each entity
            G->>FS: Write {Entity}.cs
            G->>FS: Write {Entity}Status.cs
        end
    end

    rect rgb(200, 200, 230)
        Note over G,FS: Phase 4: Generate API
        G->>FS: Write Program.cs
        loop For each entity
            G->>FS: Write {Entity}Controller.cs
            G->>FS: Write {Entity}Dto.cs
        end
        G->>FS: Write MockData classes
    end

    G->>G: dotnet build
    G-->>C: Generation Complete
    </div>

    <h2>Project Structure</h2>
    <div class="mermaid">
flowchart TD
    subgraph Solution["{Project}.sln"]
        subgraph Api["{Project}.Api"]
            Controllers[Controllers/]
            DTOs[DTOs/]
            Middleware[Middleware/]
            MockData[MockData/]
            Extensions[Extensions/]
            Program[Program.cs]
        end

        subgraph Domain["{Project}.Domain"]
            Entities[Entities/]
            Enums[Enums/]
            Common[Common/]
        end

        subgraph Services["{Project}.Services"]
            SvcInterfaces[Interfaces/]
        end

        subgraph Repos["{Project}.Repositories"]
            RepoInterfaces[Interfaces/]
        end

        subgraph SharedProj["{Project}.Shared"]
            SharedUtils[Utilities]
        end
    end

    classDef folder fill:#E3F2FD
    classDef file fill:#FFF9C4
    class Controllers,DTOs,Middleware,MockData,Extensions,Entities,Enums,Common,SvcInterfaces,RepoInterfaces,SharedUtils folder
    class Program file
    </div>

    <h2>Entity Generation Flow</h2>
    <div class="mermaid">
flowchart LR
    Input([Entity Name]) --> Analyze{Has Status?}

    Analyze -->|Yes| GenEnum[Generate Enum]
    Analyze -->|No| GenEntity[Generate Entity]

    GenEnum --> GenEntity
    GenEntity --> GenController[Generate Controller]
    GenController --> GenDTO[Generate DTOs]
    GenDTO --> GenMock[Generate MockData]
    GenMock --> Done([Complete])

    classDef decision fill:#FFE0B2
    classDef action fill:#C8E6C9
    class Analyze decision
    class GenEnum,GenEntity,GenController,GenDTO,GenMock action
    </div>

    <footer>
        <p>ln-722-backend-generator v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
