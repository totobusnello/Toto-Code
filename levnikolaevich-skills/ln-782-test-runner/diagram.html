<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-782-test-runner - Workflow Diagram</title>
    <link rel="stylesheet" href="../shared/css/diagram.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>
</head>
<body>
    <h1>ln-782-test-runner</h1>
    <p>L3 Worker - Executes all test suites and reports results</p>

    <h2>Test Execution Workflow</h2>
    <div class="mermaid">
flowchart TD
    Start([Start Test Runner]) --> Detect[Step 1: Detect Test Frameworks]

    Detect --> Found{Frameworks Found?}
    Found -->|No| NoTests([No Tests to Run])
    Found -->|Yes| Loop[For Each Test Suite]

    Loop --> Execute[Step 2: Execute Tests]
    Execute --> Timeout{Timeout?}
    Timeout -->|Yes| TimeoutErr[Log Timeout]
    Timeout -->|No| Parse[Step 3: Parse Results]

    Parse --> Coverage{Coverage Enabled?}
    Coverage -->|Yes| GenCoverage[Step 4: Generate Coverage]
    Coverage -->|No| Record[Record Results]
    GenCoverage --> Record

    TimeoutErr --> Record

    Record --> More{More Suites?}
    More -->|Yes| Loop
    More -->|No| Report[Step 5: Report Results]

    Report --> Status{All Passed?}
    Status -->|Yes| Success([Return Success])
    Status -->|No| Failures([Return with Failures])

    classDef success fill:#90EE90
    classDef fail fill:#FFB6C1
    classDef process fill:#E6E6FA
    classDef warning fill:#FFE4B5
    class Success success
    class Failures,TimeoutErr fail
    class Detect,Execute,Parse,GenCoverage,Report process
    class NoTests warning
    </div>

    <h2>Framework Detection</h2>
    <div class="mermaid">
flowchart LR
    Scan[Scan Config Files] --> Check{Check Markers}

    Check --> Vitest{vitest.config.*?}
    Check --> Jest{jest.config.*?}
    Check --> XUnit{xunit in csproj?}
    Check --> Pytest{conftest.py?}
    Check --> GoTest{*_test.go?}

    Vitest -->|Yes| V[Vitest Suite]
    Jest -->|Yes| J[Jest Suite]
    XUnit -->|Yes| X[xUnit Suite]
    Pytest -->|Yes| P[pytest Suite]
    GoTest -->|Yes| G[go test Suite]

    V --> List[Add to Test List]
    J --> List
    X --> List
    P --> List
    G --> List

    classDef marker fill:#FFE4B5
    classDef framework fill:#87CEEB
    class Vitest,Jest,XUnit,Pytest,GoTest marker
    class V,J,X,P,G framework
    </div>

    <h2>Result Structure</h2>
    <div class="mermaid">
flowchart TD
    Results([Test Results])

    Results --> Suite1[Suite 1]
    Results --> Suite2[Suite 2]
    Results --> SuiteN[Suite N...]

    Suite1 --> S1Data[framework, status, total, passed, failed, duration]
    Suite1 --> S1Failures[failures: array of test name + message]
    Suite1 --> S1Coverage[coverage: lines, percentage]

    classDef result fill:#E6E6FA
    classDef data fill:#F0F0F0
    class Suite1,Suite2,SuiteN result
    class S1Data,S1Failures,S1Coverage data
    </div>

    <footer>
        <p>ln-782-test-runner v2.0.0 | Last Updated: 2026-01-10</p>
    </footer>
</body>
</html>
