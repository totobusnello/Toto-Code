<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-200-scope-decomposer - State Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="../shared/css/diagram.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîÑ ln-200-scope-decomposer</h1>
            <p class="subtitle">Scope Decomposer (Top Orchestrator) - State Diagram v2.0.0</p>
        </header>

        <div class="info-box">
            <h3>üìã Workflow Overview</h3>
            <ul>
                <li><strong>Purpose:</strong> Full decomposition: scope ‚Üí Epics (ln-210) ‚Üí Stories (ln-220 loop)</li>
                <li><strong>Pattern:</strong> Pure Orchestrator (only routing, no work execution)</li>
                <li><strong>Delegation:</strong> ln-210-epic-coordinator v7.0.0 ‚Üí ln-220-story-coordinator v4.0.0 (sequential per Epic)</li>
                <li><strong>Output:</strong> 3-7 Epics (Epic 0: Infrastructure, Epic 1-N: Business) + 15-70 Stories (5-10 per Epic)</li>
                <li><strong>Time:</strong> 2-3 hours end-to-end</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color color-discovery"></div>
                <span>Discovery</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-loop"></div>
                <span>Delegation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-decision"></div>
                <span>Loop Control</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-action"></div>
                <span>Completion</span>
            </div>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
graph TD
    Start([Start: Decompose Initiative]) --> Phase1[Phase 1: Discovery<br/>Auto-discover Team ID<br/>from kanban_board.md]

    Phase1 --> Phase2[Phase 2: Epic Decomposition<br/>Delegate to ln-210-epic-coordinator v7.0.0]

    Phase2 --> LN210[ln-210 executes:<br/>- Research docs + HTML<br/>- Build Epic list Epic 0-N<br/>- User confirms structure<br/>- Batch preview ALL Epics<br/>- User confirms<br/>- Create ALL in Linear]

    LN210 --> WaitEpics[Wait for Epic creation complete]
    WaitEpics --> VerifyEpics[Verify: Epics in kanban_board.md<br/>Epic 0: Infrastructure if applicable<br/>Epic 1-N: Business domains]

    VerifyEpics --> Phase3[Phase 3: Story Decomposition Loop<br/>Sequential per Epic]

    Phase3 --> LoopStart[FOR EACH Epic<br/>Epic 0 ‚Üí Epic 1 ‚Üí ... ‚Üí Epic N]

    LoopStart --> CurrentEpic[Current Epic: Epic X]

    CurrentEpic --> DelegateLN220[Delegate to ln-220-story-coordinator<br/>for Epic X]

    DelegateLN220 --> LN220[ln-220 executes:<br/>- Extract Epic info<br/>- Fallback search if needed<br/>- Research standards<br/>- Generate Stories<br/>- User confirms<br/>- Create in Linear]

    LN220 --> WaitStories[Wait for Story creation complete]
    WaitStories --> VerifyStories[Verify: Stories in kanban_board.md<br/>5-10 Stories for Epic X]

    VerifyStories --> MoreEpics{More Epics<br/>to process?}
    MoreEpics -->|Yes| LoopStart
    MoreEpics -->|No| Phase4[Phase 4: Summary]

    Phase4 --> CountTotal[Count total:<br/>N Epics Epic 0-N<br/>M Stories US001-USMMM]

    CountTotal --> ShowNext[Display next steps:<br/>1. ln-320-story-validator<br/>2. ln-300-story-pipeline<br/>OR ln-310-story-decomposer]

    ShowNext --> End([End: Full Decomposition Complete])

    %% Styling
    classDef discovery fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef loop fill:#FFF9C4,stroke:#F57C00,stroke-width:2px
    classDef decision fill:#FFE0B2,stroke:#E64A19,stroke-width:2px
    classDef action fill:#C8E6C9,stroke:#388E3C,stroke-width:2px

    class Phase1 discovery
    class Phase2,Phase3,LN210,LN220,DelegateLN220,CurrentEpic,LoopStart loop
    class MoreEpics decision
    class WaitEpics,VerifyEpics,WaitStories,VerifyStories,Phase4,CountTotal,ShowNext action
            </div>
        </div>

        <div class="info-box">
            <h3>üîë Key Features v2.0.0</h3>
            <ul>
                <li><strong>Pure Orchestrator Pattern:</strong> Does NOT execute work - only routing via Skill tool</li>
                <li><strong>NO Orchestrator-Level Confirmation:</strong> Coordinators (ln-210, ln-220) handle all user interaction</li>
                <li><strong>Epic 0 Reserved:</strong> Infrastructure Epic automatically proposed by ln-210 if needed</li>
                <li><strong>Sequential Story Decomposition:</strong> Epic N Stories MUST complete before Epic N+1 starts (user interaction cannot parallelize)</li>
                <li><strong>Batch Preview in ln-210:</strong> ALL Epics shown before creation (v7.0.0 feature)</li>
                <li><strong>Fallback Search in ln-220:</strong> Auto-extract from requirements.md, tech_stack.md before asking user (v2.1.0 feature)</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>üìê Phase Structure</h3>
            <ul>
                <li><strong>Phase 1:</strong> Discovery - Auto-discover Team ID from kanban_board.md (silent, no user prompt)</li>
                <li><strong>Phase 2:</strong> Epic Decomposition - Delegate to ln-210-epic-coordinator v7.0.0 (batch preview, Epic 0 if applicable)</li>
                <li><strong>Phase 3:</strong> Story Decomposition Loop - FOR EACH Epic (Epic 0 ‚Üí Epic 1 ‚Üí ... ‚Üí Epic N), delegate to ln-220-story-coordinator v4.0.0 sequentially</li>
                <li><strong>Phase 4:</strong> Summary - Count total Epics + Stories, display next steps (validation ‚Üí task creation)</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>‚öôÔ∏è Orchestrator Responsibilities</h3>
            <ul>
                <li><strong>‚úÖ DOES:</strong> Discovery (Team ID), Routing decisions, Sequential loop management, Summary aggregation</li>
                <li><strong>‚ùå DOES NOT:</strong> Research docs, Generate documents, Create Linear issues, Prompt user (delegated to coordinators)</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>üîó Coordinator Details</h3>
            <ul>
                <li><strong>ln-210-epic-coordinator v7.0.0:</strong> Creates 3-7 Epics (Epic 0 Infrastructure + Epic 1-N Business). Batch preview ALL before creation. HTML research. User confirms twice (structure + batch preview).</li>
                <li><strong>ln-220-story-coordinator v4.0.0:</strong> Coordinator that delegates to ln-222-story-creator (CREATE mode) or ln-223-story-replanner (REPLAN mode). Creates 5-10 Stories per Epic. Fallback search chain (Epic ‚Üí requirements.md ‚Üí tech_stack.md). User confirms once (Story preview).</li>
            </ul>
        </div>

        <footer>
            <p>Generated for ln-200-scope-decomposer skill | Version 2.0.0</p>
            <p>Diagram format: Mermaid.js | Last updated: 2025-11-20</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
