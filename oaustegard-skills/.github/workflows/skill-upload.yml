name: Upload Skill

on:
  push:
    paths:
      - 'uploads/**.zip'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  upload-skill:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # Fetch current commit and parent to enable diff

      - name: Install PyYAML
        run: pip install pyyaml

      - name: Process All Skill Uploads
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_RUN_ID: ${{ github.run_id }}
          GITHUB_BEFORE_COMMIT: ${{ github.event.before }}
          GITHUB_EVENT_NAME: ${{ github.event_name }}
        run: .github/scripts/process-skill-upload.sh
