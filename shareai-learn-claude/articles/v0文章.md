# mini Claude Code v0ï¼šBash is All You Need

å½“æˆ‘ä»¬å®Œæˆ v1ã€v2ã€v3 ä¸‰ä¸ªç‰ˆæœ¬åï¼Œä¸€ä¸ªé—®é¢˜æµ®å‡ºæ°´é¢ï¼š**Agent çš„æœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ**

v1 ç”¨ 400 è¡Œä»£ç è¯æ˜äº†"æ¨¡å‹å³ä»£ç†"ï¼›v2 åŠ å…¥ Todo å®ç°ç»“æ„åŒ–è§„åˆ’ï¼›v3 å¼•å…¥ Task å·¥å…·æ”¯æŒå­ä»£ç†ã€‚åŠŸèƒ½è¶Šæ¥è¶Šå¼ºå¤§ï¼Œä½†ä»£ç ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚èƒ½ä¸èƒ½åè¿‡æ¥èµ°â€”â€”**ç”¨æœ€å°‘çš„ä»£ç ï¼Œä¿ç•™æœ€æ ¸å¿ƒçš„èƒ½åŠ›ï¼Ÿ**

ç­”æ¡ˆæ˜¯ v0ï¼š**20 è¡Œæ ¸å¿ƒä»£ç ï¼Œ1 ä¸ª bash å·¥å…·ï¼Œå´æ‹¥æœ‰å®Œæ•´çš„ Agent èƒ½åŠ›â€”â€”åŒ…æ‹¬å­ä»£ç†ã€‚**

æœ¬æ¬¡å®Œæ•´æ•™å­¦ä»£ç åœ°å€ï¼š
https://github.com/shareAI-lab/mini_claude_code

## 1. æ ¸å¿ƒæ´å¯Ÿï¼šBash æ˜¯metaæ¥å£ã€ä¸‡èƒ½å·¥å…·ç®±

Unix å“²å­¦å‘Šè¯‰æˆ‘ä»¬ï¼šä¸€åˆ‡çš†æ–‡ä»¶ï¼Œä¸€åˆ‡çš†å¯ç®¡é“ã€‚è€Œ bash æ˜¯è¿™ä¸ªå“²å­¦çš„å…¥å£ï¼š

| ä½ éœ€è¦ | bash å‘½ä»¤ |
|--------|-----------|
| è¯»æ–‡ä»¶ | `cat`, `head`, `tail`, `grep` `...` |
| å†™æ–‡ä»¶ | `echo '...' > file`, `sed -i`, `...` |
| æœç´¢ | `find`, `grep`, `rg` |
| æ‰§è¡Œ | `python`, `npm`, `make` |
| **å­ä»£ç†** | `python v0_bash_agent.py "task"`|

æœ€åä¸€è¡Œæ˜¯å…³é”®ï¼š**é€šè¿‡ bash è°ƒç”¨è‡ªèº«ï¼Œå°±å®ç°äº†å­ä»£ç†æœºåˆ¶**ã€‚ä¸éœ€è¦ Task å·¥å…·ï¼Œä¸éœ€è¦ Agent Registryï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–ä»£ç ã€‚

## 2. å®Œæ•´ç‰ˆä»£ç 

```python
#!/usr/bin/env python
"""v0_bash_agent.py - æç®€ Claude Code (20è¡Œæ ¸å¿ƒ) | Bash is All You Need"""
from anthropic import Anthropic
import subprocess, sys, os

client = Anthropic(api_key="your-api-key", base_url="https://api.moonshot.cn/anthropic")
TOOL = [{"name": "bash", "description": """Execute shell command. Common patterns:
- Read: cat/head/tail, grep/find/rg/ls, wc -l
- Write: echo 'content' > file, sed -i 's/old/new/g' file
- Subagent: python v0_bash_agent.py 'task description' (spawns isolated agent, returns summary)""",
         "input_schema": {"type": "object", "properties": {"command": {"type": "string"}}, "required": ["command"]}}]
SYSTEM = f"""You are a CLI agent at {os.getcwd()}. Solve problems using bash commands.

Rules:
- Prefer tools over prose. Act first, explain briefly after.
- Read files: cat, grep, find, rg, ls, head, tail
- Write files: echo '...' > file, sed -i, or cat << 'EOF' > file
- Subagent: For complex subtasks, spawn a subagent to keep context clean:
  python v0_bash_agent.py "explore src/ and summarize the architecture"

When to use subagent:
- Task requires reading many files (isolate the exploration)
- Task is independent and self-contained
- You want to avoid polluting current conversation with intermediate details

The subagent runs in isolation and returns only its final summary."""

def chat(prompt, history=[]):
    history.append({"role": "user", "content": prompt})
    while True:
        r = client.messages.create(model="kimi-k2-turbo-preview", system=SYSTEM, messages=history, tools=TOOL, max_tokens=8000)
        content = [{"type": b.type, **({"text": b.text} if hasattr(b, "text") else {"id": b.id, "name": b.name, "input": b.input})} for b in r.content]
        history.append({"role": "assistant", "content": content})
        if r.stop_reason != "tool_use":
            return "".join(b.text for b in r.content if hasattr(b, "text"))
        results = []
        for b in [x for x in r.content if x.type == "tool_use"]:
            print(f"\033[33m$ {b.input['command']}\033[0m")
            try: out = subprocess.run(b.input["command"], shell=True, capture_output=True, text=True, timeout=300, cwd=os.getcwd())
            except subprocess.TimeoutExpired: out = type('', (), {'stdout': '', 'stderr': '(timeout)'})()
            print(out.stdout + out.stderr or "(empty)")
            results.append({"type": "tool_result", "tool_use_id": b.id, "content": (out.stdout + out.stderr)[:50000]})
        history.append({"role": "user", "content": results})

if __name__ == "__main__":
    if len(sys.argv) > 1: print(chat(sys.argv[1]))  # å­ä»£ç†æ¨¡å¼
    else:
        h = []
        while (q := input("\033[36m>> \033[0m")) not in ("q", "exit", ""): print(chat(q, h))  # äº¤äº’æ¨¡å¼
```

## 3. å­ä»£ç†æœºåˆ¶ï¼šé€’å½’çš„ä¼˜é›…

v3 ç”¨äº† ~150 è¡Œä»£ç å®ç°å­ä»£ç†ï¼šAgent Registryã€Task å·¥å…·ã€å·¥å…·è¿‡æ»¤ã€è¿›åº¦æ˜¾ç¤º...

v0 åªéœ€è¦ä¸€è¡Œ bash å‘½ä»¤ï¼š

```bash
python v0_bash_agent.py "explore the codebase and summarize"
```

**ä¸ºä»€ä¹ˆè¿™èƒ½å·¥ä½œï¼Ÿ**

1. **è¿›ç¨‹éš”ç¦»** = ä¸Šä¸‹æ–‡éš”ç¦»
   - å­è¿›ç¨‹æœ‰ç‹¬ç«‹çš„ `history=[]`
   - ä¸ä¼šæ±¡æŸ“çˆ¶è¿›ç¨‹çš„å¯¹è¯å†å²

2. **stdout** = ç»“æœè¿”å›
   - å­ä»£ç†çš„ `print(chat(...))` è¾“å‡ºåˆ° stdout
   - çˆ¶ä»£ç†é€šè¿‡ `subprocess` æ•è·ï¼Œä½œä¸ºå·¥å…·ç»“æœ

3. **é€’å½’è°ƒç”¨** = æ— é™åµŒå¥—
   - å­ä»£ç†å¯ä»¥å†è°ƒç”¨å­ä»£ç†
   - å¤©ç„¶æ”¯æŒä»»æ„æ·±åº¦çš„ä»»åŠ¡åˆ†è§£

```sh
ä¸»ä»£ç†
  â””â”€ bash: python v0_bash_agent.py "åˆ†ææ¶æ„"
       â””â”€ å­ä»£ç†ï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼Œç‹¬ç«‹å†å²ï¼‰
            â”œâ”€ bash: find . -name "*.py"
            â”œâ”€ bash: cat src/main.py
            â””â”€ è¿”å›æ‘˜è¦ â†’ stdout â†’ çˆ¶ä»£ç†æ”¶åˆ°ç»“æœ
```

## 4. ä¸ v3 çš„å¯¹æ¯”

| æœºåˆ¶ | v3 (Task å·¥å…·) | v0 (Bash é€’å½’) |
|------|----------------|----------------|
| ä»£ç è¡Œæ•° | ~900 è¡Œ | ~50 è¡Œ |
| å­ä»£ç†å®ç° | Task tool + Agent Registry | `python self 'task'` |
| ä¸Šä¸‹æ–‡éš”ç¦» | ç‹¬ç«‹ messages[] | ç‹¬ç«‹è¿›ç¨‹ |
| å·¥å…·è¿‡æ»¤ | ç™½åå•æœºåˆ¶ | æ— ï¼ˆbash ä¸‡èƒ½ï¼‰ |
| è¿›åº¦æ˜¾ç¤º | SubagentProgress ç±» | ç›´æ¥ stdout |
| çµæ´»æ€§ | é«˜ï¼ˆå¤šç§ä»£ç†ç±»å‹ï¼‰ | ä¸­ï¼ˆç»Ÿä¸€è¡Œä¸ºï¼‰ |

**v0 ç‰ºç‰²äº†ä»€ä¹ˆï¼Ÿ**
- æ²¡æœ‰ä»£ç†ç±»å‹åŒºåˆ†ï¼ˆexplore/code/planï¼‰
- æ²¡æœ‰å·¥å…·ç™½åå•ï¼ˆå­ä»£ç†ä¹Ÿèƒ½å†™æ–‡ä»¶ï¼‰
- æ²¡æœ‰ä¼˜é›…çš„è¿›åº¦æ˜¾ç¤º

**v0 å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿ**
- æè‡´ç®€æ´ï¼š20 è¡Œæ ¸å¿ƒé€»è¾‘
- é›¶é¢å¤–æ¦‚å¿µï¼šä¸éœ€è¦ç†è§£ Taskã€Agent Registry
- å®Œæ•´èƒ½åŠ›ï¼šè¯»ã€å†™ã€æœç´¢ã€æ‰§è¡Œã€å­ä»£ç†

## 5. èƒŒåçš„æ€æƒ³

> **ç®€å•ç³»ç»Ÿçš„æ¶Œç°èƒ½åŠ›**

v0 è¯æ˜äº†ä¸€ä¸ªåç›´è§‰çš„äº‹å®ï¼š**å¤æ‚èƒ½åŠ›å¯ä»¥ä»ç®€å•è§„åˆ™ä¸­æ¶Œç°**ã€‚

1. **ä¸€ä¸ªå·¥å…·è¶³çŸ£**

   bash æ˜¯é€šå¾€ Unix ä¸–ç•Œçš„å¤§é—¨ã€‚é€šè¿‡å®ƒï¼Œæ¨¡å‹å¯ä»¥è°ƒç”¨ä»»ä½•å‘½ä»¤ã€ä»»ä½•ç¨‹åºã€ä»»ä½•è„šæœ¬ã€‚ä¸éœ€è¦ä¸ºæ¯ç§èƒ½åŠ›å•ç‹¬å®ç°å·¥å…·ã€‚

2. **é€’å½’å³å±‚çº§**

   ç¨‹åºè°ƒç”¨è‡ªèº«æ˜¯è®¡ç®—æœºç§‘å­¦æœ€ä¼˜é›…çš„æ¨¡å¼ä¹‹ä¸€ã€‚v0 ç”¨åŒæ ·çš„æ–¹å¼å®ç°å­ä»£ç†ï¼šä¸æ˜¯è®¾è®¡æ–°æœºåˆ¶ï¼Œè€Œæ˜¯å¤ç”¨å·²æœ‰èƒ½åŠ›ã€‚

3. **è¿›ç¨‹å³éš”ç¦»**

   æ“ä½œç³»ç»Ÿæ—©å°±è§£å†³äº†"å¦‚ä½•éš”ç¦»æ‰§è¡Œç¯å¢ƒ"çš„é—®é¢˜ã€‚v0 ç›´æ¥å€Ÿç”¨è¿™ä¸ªèƒ½åŠ›ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨å±‚é‡æ–°å®ç°ã€‚

4. **çº¦æŸåœ¨æç¤ºè¯**

   v3 ç”¨ä»£ç å®ç°å·¥å…·è¿‡æ»¤ï¼›v0 ç”¨æç¤ºè¯å¼•å¯¼è¡Œä¸ºã€‚å‰è€…æ˜¯ç¡¬çº¦æŸï¼Œåè€…æ˜¯è½¯çº¦æŸã€‚å¯¹äºæ•™å­¦ç›®çš„ï¼Œè½¯çº¦æŸè¶³å¤Ÿäº†ã€‚

## 6. æé™å‹ç¼©ç‰ˆï¼ˆ16 è¡Œï¼‰

å¦‚æœè¿½æ±‚æè‡´ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥å‹ç¼©ï¼š

```python
#!/usr/bin/env python
"""v0_bash_agent_mini.py - æé™å‹ç¼©ç‰ˆ ï¼ˆ16 è¡Œï¼‰"""
from anthropic import Anthropic; import subprocess as sp, sys, os
C = Anthropic(api_key="your-key", base_url="https://api.moonshot.cn/anthropic")
T = [{"name":"bash","description":"Shell. Subagent: python v0_bash_agent_mini.py 'task'","input_schema":{"type":"object","properties":{"command":{"type":"string"}},"required":["command"]}}]
S = f"CLI agent at {os.getcwd()}. Use bash. Spawn subagent for complex tasks. Be concise."

def chat(p, h=[]):
    h.append({"role":"user","content":p})
    while (r:=C.messages.create(model="kimi-k2-turbo-preview",system=S,messages=h,tools=T,max_tokens=8000)).stop_reason=="tool_use":
        h.append({"role":"assistant","content":[{"type":b.type,**({"text":b.text}if hasattr(b,"text")else{"id":b.id,"name":b.name,"input":b.input})}for b in r.content]})
        h.append({"role":"user","content":[{"type":"tool_result","tool_use_id":b.id,"content":(print(f"\033[33m$ {b.input['command']}\033[0m"),o:=sp.run(b.input["command"],shell=1,capture_output=1,text=1,timeout=300),print(o.stdout+o.stderr or"(empty)"))and""or(o.stdout+o.stderr)[:50000]}for b in r.content if b.type=="tool_use"]})
    h.append({"role":"assistant","content":[{"type":b.type,**({"text":b.text}if hasattr(b,"text")else{"id":b.id,"name":b.name,"input":b.input})}for b in r.content]})
    return "".join(b.text for b in r.content if hasattr(b,"text"))

if __name__=="__main__":[print(chat(sys.argv[1]))]if len(sys.argv)>1 else[print(chat(q,h))for h in[[]]for _ in iter(int,1)if(q:=input("\033[36m>> \033[0m"))not in("q","")]
```

16 è¡Œï¼ŒåŠŸèƒ½å®Œå…¨ç›¸åŒã€‚çº¯å±ç‚«æŠ€ï¼Œä¸æ¨èç”¨äºå­¦ä¹ ã€‚

## 7. ç³»åˆ—æ€»ç»“

| ç‰ˆæœ¬ | è¡Œæ•° | æ ¸å¿ƒä¸»é¢˜ | å…³é”®æ´å¯Ÿ |
|------|------|----------|----------|
| **v0** | ~50 | Bash is All You Need | ä¸€ä¸ªå·¥å…· + é€’å½’ = å®Œæ•´ Agent |
| v1 | ~400 | Model as Agent | æ¨¡å‹æ˜¯ä¸»ä½“ï¼Œä»£ç æ˜¯å·¥å…·å¾ªç¯ |
| v2 | ~650 | ç»“æ„åŒ–è§„åˆ’ | Todo å·¥å…·å¼•å¯¼æ¨¡å‹è¡Œä¸º |
| v3 | ~900 | åˆ†è€Œæ²»ä¹‹ | Task å·¥å…·å®ç°ä¸“ä¸šåŒ–å­ä»£ç† |

**ä» v0 åˆ° v3ï¼Œä»£ç åœ¨å¢åŠ ï¼Œä½†æ ¸å¿ƒæ²¡å˜ï¼š**

```sh
while True:
    response = model.call(messages, tools)
    if response.stop_reason != "tool_use":
        return response.text
    results = execute_tools(response.tool_calls)
    messages.append(results)
```

è¿™å°±æ˜¯ Agent çš„å…¨éƒ¨æœ¬è´¨â€”â€”**ä¸€ä¸ªè®©æ¨¡å‹æŒç»­è°ƒç”¨å·¥å…·ç›´åˆ°å®Œæˆä»»åŠ¡çš„å¾ªç¯**ã€‚

v0 ç”¨æœ€å°‘çš„ä»£ç è¯æ˜äº†è¿™ä¸€ç‚¹ã€‚å…¶ä»–ç‰ˆæœ¬åªæ˜¯åœ¨è¿™ä¸ªæ¡†æ¶ä¸Šæ·»åŠ ç»†åˆ™ï¼šTodo è®©è§„åˆ’å¯è§ï¼ŒTask è®©åˆ†å·¥æˆä¸ºå¯èƒ½ï¼Œè¿›åº¦æ˜¾ç¤ºè®©è¿‡ç¨‹å¯è§‚æµ‹ã€‚ä½†å¤§çš„æ¡†æ¶ä»æœªæ”¹å˜


ğŸ‘‹ ä»£ç æ˜¯æ€æƒ³åœ¨è®¡ç®—æœºä¸–ç•Œçš„æŠ•å½±ï¼ŒAgentä»£ç æ˜¯ã€Agentæ¨¡å‹ä¸ã€çœŸå®è®¡ç®—æœºç³»ç»Ÿã€é—´çš„â€œä¿¡å·çº¿â€ã€‘

---

**Bash is All You Need.**

å®Œæ•´ä»£ç è§ä»“åº“ `v0_bash_agent.py` å’Œ `v0_bash_agent_mini.py`ã€‚


å¦‚æœä½ æƒ³è¦ç”Ÿäº§çº§å®ç°ï¼Œæ¬¢è¿ä½¿ç”¨ [Kode Agent CLI](https://github.com/shareAI-lab/Kode)